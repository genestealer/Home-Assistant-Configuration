##############################################################
# Richard Huish 2025
# ESPHome Configuration - Office IKEA FORNÜFTIG Air Purifier
# Repository: https://github.com/genestealer/Home-Assistant-Configuration
#
# Description:
# This ESPHome configuration allows control of an IKEA FORNÜFTIG Air Purifier 
# using an ESP8266 (NodeMCU v2) while retaining the original PCB.
#
# Features:
# - Fan speed control (OFF, Low, Medium, High).
# - Monitoring filter status via LED detection (ADC input).
# - Integration with Home Assistant for remote control.
#
# Hardware:
# - ESP8266 (NodeMCU v2)
# - IKEA FORNÜFTIG Air Purifier (Factory PCB retained)
# - DC-DC Step-Down Converter (e.g., LM2596 / Mini-360)
#
# WIRING & PCB MODIFICATIONS
#
# Powering the ESP8266:
# - The IKEA FORNÜFTIG air purifier operates at 24V DC.
# - Use a DC-DC converter to step down 24V to 3.3V (or 5V for VIN pin on the ESP8266).
#
# Rotary Switch (Manual Control) Modifications:
# - Cut the 5 pins connecting the rotary switch to the PCB.
# - The ESP8266 will read manual switch positions while overriding fan speed control.
#
# Connections to ESP8266:
# - Filter LED Detection (ADC Input):
#   - A0 → Positive side of the IKEA filter LED
#
# - Fan Speed Outputs (ESP to IKEA PCB):
#   - D2 → High Speed (PCB Pin 2)
#   - D3 → Medium Speed (PCB Pin 3)
#   - D4 → Low Speed (PCB Pin 4)
#
# - Rotary Switch Inputs (Manual Mode from User):
#   - D1 → Off Position
#   - D5 → Low Speed
#   - D6 → Medium Speed
#   - D7 → High Speed
#
# - GND Connections:
#   - Two end pins of the rotary switch → ESP GND
#
# This allows both manual control and ESPHome automation!
#
##############################################################

# Substitutions for Easy Configuration
substitutions:
  # Naming
  name: office-air-purifier
  friendly_name: "Office FORNÜFTIG Air Purifier"
  ui_comment: "IKEA FORNÜFTIG Air Purifier Control"

  # Network Configuration (Static IP)
  ip: 192.168.2.49
  gateway: 192.168.2.1
  subnet: 255.255.255.0

  # Status LED Configuration
  status_led: D0  # GPIO16 - NodeMCU onboard LED
  status_led_inverted: "true"

  # Debug Logging Level
  log_level: DEBUG

  # Sensor Update Interval
  sensor_update_interval: 5min
  wifi_sensor_update_interval: 10min

##############################################################
# Board Configuration
##############################################################
esp8266:
  board: nodemcuv2

##############################################################
# Import Shared Code (Common Components)
##############################################################
packages:
  device_base: !include common/device_base.yaml
  status_led: !include common/status_led.yaml
  wifi: !include common/device_base_wifi.yaml
  # Uncomment below to remove the status LED:
  # status_led: !remove
  fornuftig: !include common/fornuftig.yaml

##############################################################
# Fornuftig Configuration
##############################################################
# Uses shared Fornuftig configuration from common/fornuftig.yaml