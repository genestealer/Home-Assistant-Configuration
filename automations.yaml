- id: '1558317969078'
  alias: CCTV Reboot Each Monday
  triggers:
  - at: 06:45
    trigger: time
  conditions:
  - condition: time
    weekday:
    - mon
  actions:
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id:
      - button.drive_high_25_reboot
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.drive_long_31_reboot
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id:
      - button.front_door_33_reboot
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.front_garden_27_reboot
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.garage_32_reboot
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.garden_30_reboot
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.parking_space_onvif_reboot
- id: '1564192629041'
  alias: 'Irrigation: Pot Irrigation Script Off to Valve Off'
  description: 'If script is turned off manually, then close valve, else it will stay
    open. '
  trigger:
  - entity_id: script.front_garden_pot_irrigation_timer
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: switch.front_garden_pot_irrigation_valve
    service: switch.turn_off
- id: '1564192623451'
  alias: 'Irrigation: Irrigate Front Garden Pots at Sunrise'
  trigger:
  - platform: template
    value_template: '{{states(''sensor.time'') == states(''sensor.front_garden_pot_irrigation_next_run'')[19:24]}}'
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{states(''sensor.front_garden_pot_irrigation_next_run'')[5:15]
        == now().date().strftime(''%d-%m-%Y'')}}'
    - condition: state
      entity_id: sensor.front_garden_pots_irrigation_interlock
      state: Uninhibited
  action:
  - entity_id: script.front_garden_pot_irrigation_timer
    service: script.front_garden_pot_irrigation_timer
- id: '1564192123451'
  alias: 'Irrigation: Irrigate Back Garden at Sunrise'
  description: With editable offset
  trigger:
  - platform: template
    value_template: '{{states(''sensor.time'') == states(''sensor.back_garden_irrigation_next_run'')[19:24]}}'
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{states(''sensor.back_garden_irrigation_next_run'')[5:15]
        == now().date().strftime(''%d-%m-%Y'')}}'
    - condition: state
      entity_id: sensor.back_garden_irrigation_interlock
      state: Uninhibited
  action:
  - entity_id: script.back_garden_irrigation_timer
    service: script.back_garden_irrigation_timer
- id: '1564192123123'
  alias: 'Irrigation: Irrigate Back Garden Lawn at Sunrise'
  trigger:
  - platform: template
    value_template: '{{states(''sensor.time'') == states(''sensor.back_garden_lawn_irrigation_next_run'')[19:24]}}'
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{states(''sensor.back_garden_lawn_irrigation_next_run'')[5:15]
        == now().date().strftime(''%d-%m-%Y'')}}'
    - condition: state
      entity_id: sensor.back_garden_lawn_irrigation_interlock
      state: Uninhibited
  action:
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - entity_id: script.back_garden_lawn_irrigation_timer
    service: script.back_garden_lawn_irrigation_timer
- id: '1564192623452'
  alias: 'Irrigation: Irrigate Front Lawn at Sunrise'
  trigger:
  - platform: template
    value_template: '{{states(''sensor.time'') == states(''sensor.front_garden_lawn_irrigation_next_run'')[19:24]}}'
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{states(''sensor.front_garden_lawn_irrigation_next_run'')[5:15]
        == now().date().strftime(''%d-%m-%Y'')}}'
    - condition: state
      entity_id: sensor.front_garden_lawn_irrigation_interlock
      state: Uninhibited
  action:
  - entity_id: script.front_garden_lawn_irrigation_timer
    service: script.front_garden_lawn_irrigation_timer
- id: '1564234217905'
  alias: 'Irrigation: Lawn Irrigation Script Off to Valve Off'
  description: 'If script is turned off manually, then close valve, else it will stay
    open. '
  trigger:
  - entity_id: script.front_garden_lawn_irrigation_timer
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: switch.front_garden_lawn_irrigation_valve
    service: switch.turn_off
- id: '1512334217905'
  alias: 'Irrigation: Garden Irrigation Script Off to Valve Off'
  description: 'If script is turned off manually, then close valve, else it will stay
    open. '
  trigger:
  - entity_id: script.back_garden_irrigation_timer
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: switch.back_garden_irrigation_valve
    service: switch.turn_off
- id: '1512331237905'
  alias: 'Irrigation: Garden Lawn Irrigation Script Off to Valve Off'
  description: 'If script is turned off manually, then close valve, else it will stay
    open. '
  trigger:
  - entity_id: script.back_garden_lawn_irrigation_timer
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: switch.back_garden_lawn_1_irrigation_valve
    service: switch.turn_off
  - entity_id: switch.back_garden_lawn_2_irrigation_valve
    service: switch.turn_off
- id: '1576599112935'
  alias: Welcome home Richard
  description: 'Note: These actions can only be edited with YAML'
  trigger:
  - entity_id: person.richard
    for: 00:05:00
    from: not_home
    platform: state
    to: home
  condition: []
  action:
  - data_template:
      cache: false
      entity_id: media_player.ground_floor
      message: "Welcome home Richard. {% if is_state('person.lucy', 'home')  %} Lucy
        is also at home and needs cuddles! {%- else -%}\n    Lucy is away at {{state_attr('device_tracker.google_maps_114635444798949098363',
        'address')}}.\n {%- endif %}\n    Outside {{states('sensor.dark_sky_temperature')|
        round(0)}}C {{states('sensor.dark_sky_humidity')| round(0) }}% Inside {{states('sensor.entryway_thermostat_temperature')|
        round(0)}}C \n{{states('sensor.entryway_thermostat_humidity')| round(0)}}%
        {% if is_state('climate.entryway', 'heat') %} Heating on and set to {{state_attr('climate.entryway',
        'temperature')| round(0) }}°C\n{%- endif %}\n"
    service: tts.google_translate_say
- id: '1576601014597'
  alias: Plug-in Air Freshener - On-Off Automation
  description: 'Turn on in the morning when someone is home as long as it between
    certain times. Also turns back on after returning home. Turn off in the evening
    or when no one is home. Repeat as it sometimes does not work '
  trigger:
  - platform: time
    at: input_datetime.air_freshener_on_time
  - platform: time
    at: input_datetime.air_freshener_off_time
  - platform: zone
    entity_id: person.richard
    zone: zone.home
    event: leave
    enabled: false
  - platform: zone
    entity_id: person.richard
    zone: zone.home
    event: enter
    enabled: false
  - platform: zone
    entity_id: person.lucy
    zone: zone.home
    event: enter
    enabled: false
  - platform: zone
    entity_id: person.lucy
    zone: zone.home
    event: leave
    enabled: false
  - platform: state
    entity_id:
    - person.lucy
    to:
    for:
      hours: 0
      minutes: 5
      seconds: 0
    enabled: true
  - platform: state
    entity_id:
    - person.richard
    to:
    for:
      hours: 0
      minutes: 5
      seconds: 0
    enabled: true
  condition: []
  action:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: time
          after: input_datetime.air_freshener_on_time
          before: input_datetime.air_freshener_off_time
        - condition: or
          conditions:
          - condition: state
            entity_id: person.lucy
            state: home
          - condition: state
            entity_id: person.richard
            state: home
      sequence:
      - service: switch.turn_on
        target:
          entity_id:
          - switch.plug_in_air_freshener_1
        data: {}
      - delay:
          hours: 0
          minutes: 1
          seconds: 0
          milliseconds: 0
      - service: switch.turn_on
        target:
          entity_id:
          - switch.plug_in_air_freshener_2
        data: {}
    default:
    - service: switch.turn_off
      target:
        entity_id:
        - switch.plug_in_air_freshener_1
      data: {}
    - delay:
        hours: 0
        minutes: 1
        seconds: 0
        milliseconds: 0
    - service: switch.turn_off
      target:
        entity_id:
        - switch.plug_in_air_freshener_2
      data: {}
  mode: restart
- id: '1576601770197'
  alias: Welcome home Lucy
  description: 'Note: These actions can only be edited with YAML'
  trigger:
  - entity_id: person.lucy
    for: 00:05:00
    from: not_home
    platform: state
    to: home
  condition: []
  action:
  - data_template:
      cache: false
      entity_id: media_player.ground_floor
      message: "Welcome home Lucy. {% if is_state(\"person.richard\", \"home\")  %}
        Richard is also at home, please see him for cuddles! {%- else -%}\n    Richard
        is currently {{states('person.richard')}}, at\n{{states('sensor.richard_street_location')}}.
        {%- endif %} The heating is set to {{states('climate.entryway')}} at {{state_attr('climate.entryway',
        'temperature')| round(0) }}°C\n"
    service: tts.google_translate_say
- id: '1576602219341'
  alias: Keep Nest thermostat aware of our presence
  description: contindion template {{ state_attr('climate.entryway', 'preset_mode')
    == Away and Eco }}
  trigger:
  - minutes: /10
    platform: time_pattern
  - event: start
    platform: homeassistant
  - entity_id: binary_sensor.huishs_away
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: group.mobiles_group
    state: home
  - condition: state
    entity_id: binary_sensor.huishs_away
    state: 'on'
  action:
  - data:
      away_mode: home
    service: nest.set_away_mode
  - data:
      message: Nest forced back to heat mode while you are at home.
    service: notify.google_cloud_notify
- id: '1581770041173'
  alias: Electricity supply voltage is LOW/HIGH and Power Cut / Loss of Mains
  description: Send Notification when Electricity Voltage is Low or High
  triggers:
  - above: '254'
    entity_id: sensor.myups_input_voltage
    trigger: numeric_state
    id: high
  - below: '220'
    entity_id: sensor.myups_input_voltage
    trigger: numeric_state
    id: low
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - low
      sequence:
      - data:
          data:
            color: white
            channel: Electricity
            vibrationPattern: 100,500,100,500,100,500,100,500
            importance: high
            visibility: public
            notification_icon: mdi:lightning-bolt
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Electricity Voltage: {{ states(''sensor.myups_input_voltage'')
            }} Volts. {{now().strftime(''%Y-%m-%d %I:%M %p'')}}

            '
          title: Electricity Voltage Low
        action: notify.mobile_app_rich_mob_app
    - conditions:
      - condition: trigger
        id:
        - high
      sequence:
      - data:
          data:
            color: white
            channel: Electricity
            vibrationPattern: 100,500,100,500,100,500,100,500
            importance: high
            visibility: public
            notification_icon: mdi:lightning-bolt
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Electricity Voltage: {{ states(''sensor.myups_input_voltage'')
            }} Volts. {{now().strftime(''%Y-%m-%d %I:%M %p'')}}

            '
          title: Electricity Voltage High
        action: notify.mobile_app_rich_mob_app
- id: '1581770321118'
  alias: 'Notify: UPS is close to being depleted'
  description: Send Notification when UPS is about to shutdown (10 mins left)
  triggers:
  - below: 600
    entity_id: sensor.myups_battery_runtime
    trigger: numeric_state
  conditions: []
  actions:
  - data:
      data:
        color: white
        channel: Electricity
        vibrationPattern: 100,500,100,500,100,500,100,500
        importance: high
        visibility: public
        notification_icon: mdi:lightning-bolt
        ttl: 0
        priority: high
        sticky: 'true'
      message: 'UPS is running low: {{ (((states(''sensor.myups_battery_runtime'')
        | int) / 60) | int  )}} minutes left. {{now().strftime(''%Y-%m-%d %I:%M %p'')}}

        '
      title: 'WARNING: UPS close to being depleted'
    action: notify.mobile_app_rich_mob_app
- id: '1581123123827'
  alias: Simulate Presence Lights - OLD
  description: Automation Simulate Presence / Occupancy Simulation. Runs single and
    if we get home it will turn off all the lights (cancel the run)
  triggers:
  - entity_id:
    - person.richard
    from: home
    to:
    trigger: state
  - entity_id:
    - person.lucy
    from: home
    to: not_home
    trigger: state
  - event: sunset
    offset: +00:30:00
    trigger: sun
  - event_type: event_simulate_presence
    trigger: event
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: sun.sun
      state: below_horizon
    - before: '23:55:00'
      condition: time
    - condition: state
      entity_id: input_boolean.simulate_presence_enable
      state: 'on'
    - condition: state
      entity_id: person.lucy
      state: not_home
    - condition: state
      entity_id: person.richard
      state: not_home
  actions:
  - data_template:
      entity_id: '{{ state_attr(''light.presence_simulation_lights_group'', ''entity_id'')
        | random }}'
    action: light.turn_on
  - delay: 00:{{ (range(10, 30) | random) }}:00
  - if:
    - condition: or
      conditions:
      - condition: time
        after: '11:50:00'
      - condition: state
        entity_id: person.lucy
        state: home
      - condition: state
        entity_id: person.richard
        state: home
    then:
    - data: {}
      target:
        entity_id: light.presence_simulation_lights_group
      action: light.turn_off
  - data_template:
      entity_id: '{{ state_attr(''light.presence_simulation_lights_group'', ''entity_id'')
        | random }}'
    action: light.turn_on
  - delay: 00:{{ (range(10, 30) | random) }}:00
  - data_template:
      entity_id: '{{ state_attr(''light.presence_simulation_lights_group'', ''entity_id'')
        | random }}'
    action: light.turn_off
  - if:
    - condition: or
      conditions:
      - condition: time
        after: '11:50:00'
        enabled: false
      - condition: state
        entity_id: person.lucy
        state: home
      - condition: state
        entity_id: person.richard
        state: home
    then:
    - data: {}
      target:
        entity_id: light.presence_simulation_lights_group
      action: light.turn_off
  - event: event_simulate_presence
  mode: single
- id: '1590103997253'
  alias: 'Server Getting Hot '
  description: ''
  trigger:
  - above: '65'
    entity_id: sensor.server_server_raid_controller_temperature
    platform: numeric_state
  condition: []
  action:
  - data:
      message: Server is getting HOT!
    service: notify.google_cloud_notify
- id: '1601037277352'
  alias: Proximity/Perimeter Warning System - Primary and Secondary Zone Failure
  description: ''
  trigger:
  - platform: zone
    entity_id: device_tracker.google_maps_113691586554404814686
    zone: zone.outer_perimeter
    event: enter
  - platform: zone
    entity_id: device_tracker.google_maps_113691586554404814686
    zone: zone.inner_perimeter
    event: enter
  condition:
  - condition: or
    conditions:
    - condition: zone
      entity_id: person.richard
      zone: zone.home
    - condition: zone
      entity_id: person.lucy
      zone: zone.home
  action:
  - choose:
    - conditions:
      - condition: zone
        entity_id: device_tracker.google_maps_113691586554404814686
        zone: zone.inner_perimeter
      sequence:
      - service: notify.google_cloud_notify
        data:
          message: '!!Primary Zone Failure - Inner Perimeter!!'
      - service: notify.pushover_notify
        data:
          message: '!!Primary Zone Failure - Inner Perimeter!!'
          title: '!!Primary Zone Failure - Inner Perimeter!!'
          data:
            sound: alien
            priority: 1
      - service: script.flash_dining_room_lights
      - service: script.flash_dining_room_lights
      - data:
          cache: false
          entity_id: media_player.whole_house
          message: WOOP! WOOP! WOOP! WOOP! WOOP! ALERT:Warning! Primary Zone Failure!
            Warning! Primary Zone Failure! Warning! Primary Zone Failure! Close the
            fucking doors and windows for the love of bunnies hide! Arg!!!!
        service: tts.google_translate_say
    - conditions:
      - condition: zone
        entity_id: device_tracker.google_maps_113691586554404814686
        zone: zone.outer_perimeter
      sequence:
      - service: notify.google_cloud_notify
        data:
          message: Secondary Zone Failure - Outer Perimeter
      - service: notify.pushover_notify
        data:
          message: Secondary Zone Failure - Outer Perimeter
          title: Secondary Zone Failure - Outer Perimeter
          data:
            sound: tugboat
            priority: 0
      - data:
          cache: false
          entity_id: media_player.whole_house
          message: Notice! Secondary Zone Failure! Secondary Zone Failure - Outer
            Perimeter - Outer Perimeter
        service: tts.google_translate_say
  mode: single
- id: '1601317646616'
  alias: Front Lawn Anti Cat Defences
  description: Front Lawn Anti Cat Defence
  triggers:
  - type: motion
    device_id: 87201d5d821a2cdd3af103bf786ea9dd
    entity_id: 41fd6784968fd61214cd2430a8e33d7e
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: time
    after: input_datetime.fld_active_start
    before: input_datetime.fld_active_till
  - type: is_no_motion
    condition: device
    device_id: 62df1233f7995b1bf37b76783642c7e1
    entity_id: fe73852fb367e4e940be6013fdecfdb9
    domain: binary_sensor
  - condition: device
    type: is_off
    device_id: fb68d2173fd8575a3da86c0b9ad1781c
    entity_id: 6d5a3e09e8f10af0f688a9707d038de7
    domain: light
  - condition: numeric_state
    entity_id: sensor.internet_temperature
    above: 6
  - type: is_not_open
    condition: device
    device_id: 86b815b15cbf84a75984db3b46f6cc17
    entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
    domain: binary_sensor
  - type: is_not_occupied
    condition: device
    device_id: a4d9035dcf8d5c8cad4f0a74d46b0c86
    entity_id: c0aa981ae14899cc5d0ad845e5dfddb9
    domain: binary_sensor
  actions:
  - entity_id: switch.front_garden_lawn_irrigation_valve
    action: switch.turn_on
  - delay:
      hours: 0
      minutes: 0
      seconds: '{{ states(''input_number.fld_water_on_time'')|float }}'
      milliseconds: 0
  - entity_id: switch.front_garden_lawn_irrigation_valve
    action: switch.turn_off
  mode: restart
- id: '1607604378569'
  alias: AutoHotKey - Webhook Driven - Busy Light - Process Presence Incoming Webhook
  description: 'If the automation is not restarted within 6 minutes due to a new incoming
    webhook, the status is changed to offline.  Ref: https://github.com/ajobbins/AHK-Teams-Presence'
  trigger:
  - platform: webhook
    webhook_id: 6pKQYcAJY3kWdj56MVUYb4tWLr9QmGP7kKYBd5rMBz9r6ZBrQXyKhJPbuYR3vVkV
    allowed_methods:
    - POST
    - PUT
    local_only: true
  condition: []
  action:
  - service: input_text.set_value
    data:
      value: '{{ trigger.json.status }}'
    entity_id: input_text.autohotkey1
  - delay: 00:06:00
  - service: input_text.set_value
    data:
      value: Offline
    entity_id: input_text.autohotkey1
  mode: restart
- id: '1607605238090'
  alias: AutoHotKey - Webhook Driven - Busy Light - Change Busy Light Colours
  description: 'Change an RGB light to signal presence. Ref: https://github.com/ajobbins/AHK-Teams-Presence'
  triggers:
  - entity_id: input_text.autohotkey1
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: Available
      sequence:
      - data:
          color_name: green
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: Busy
      sequence:
      - data:
          color_name: red
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: On The Phone
      sequence:
      - data:
          color_name: orange
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: In A Meeting
      sequence:
      - data:
          color_name: orange
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: Do Not Disturb
      sequence:
      - data:
          color_name: blueviolet
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: Focusing
      sequence:
      - data:
          color_name: blueviolet
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: Presenting
      sequence:
      - data:
          color_name: red
          transition: 3
          brightness_pct: 100
        target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: input_text.autohotkey1
        state: Away
      sequence:
      - target:
          entity_id:
          - light.busy_light_mk2_2_busy_light
          - light.busy_light_mk2_1_busy_light
        data:
          transition: 3
        action: light.turn_off
    default:
    - data:
        transition: 3
      target:
        entity_id:
        - light.busy_light_mk2_2_busy_light
        - light.busy_light_mk2_1_busy_light
      action: light.turn_off
  mode: restart
- id: '1619906809678'
  alias: Outside Lights - House Number Sign Light Schedule
  description: ' Use wait to ensure the Choose action for time is after the trigger
    time, not on the time.'
  trigger:
  - platform: sun
    event: sunset
    offset: +00:30:00
    id: Turn On
  - platform: time
    at: input_datetime.house_sign_light_off_time
    id: Turn Off
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Turn Off
      sequence:
      - target:
          entity_id:
          - light.outside_2_down
        data: {}
        action: light.turn_off
    - conditions:
      - condition: trigger
        id:
        - Turn On
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.outside_2_down
        data:
          brightness_pct: 1
          kelvin: 6500
  mode: single
- id: '1621103260448'
  alias: Ice Maker - On-Off Automation
  description: 'On-Off Schedule with presence awareness, state restoration and high
    temperature alarm (Turn on the ice maker for a set time if the water temperature
    goes above a set threshold. Only run if ice maker is not already on). Removes
    the previous blueprint and other automations. Note: Zone trigger does not support
    delay, hence the use of the state trigger for presence awareness (to avoid frequent  switch
    cycling whilst at home with poor location accuracy) I.E. Check if the ice maker
    is off before trying to turn it on, and vice versa.'
  trigger:
  - platform: time
    at: input_datetime.ice_maker_on_time
    id: 'On'
  - platform: time
    at: input_datetime.ice_maker_off_time
    id: 'Off'
  - platform: zone
    entity_id: person.richard
    zone: zone.home
    event: leave
    id: 'Off'
  - platform: zone
    entity_id: person.richard
    zone: zone.home
    event: enter
    id: 'On'
  - platform: numeric_state
    entity_id:
    - sensor.icemaker_water_temperature
    above: input_number.ice_maker_water_high_temperature_threshold
    id: Hot
  - type: connected
    platform: device
    device_id: 996ea9226cbd0c2fe7ddb21af32045f9
    entity_id: 1ef6ddd3ef1e712df001733e0ac1d6a9
    domain: binary_sensor
    id: Check
  condition: []
  action:
  - choose:
    - conditions:
      - condition: time
        after: input_datetime.ice_maker_on_time
        before: input_datetime.ice_maker_off_time
      - condition: zone
        entity_id: person.richard
        zone: zone.home
      sequence:
      - if:
        - condition: device
          type: is_off
          device_id: 996ea9226cbd0c2fe7ddb21af32045f9
          entity_id: 9dc6d48cc35cec309bb214c849c5c7df
          domain: switch
          enabled: true
        then:
        - type: turn_on
          device_id: 996ea9226cbd0c2fe7ddb21af32045f9
          entity_id: 9dc6d48cc35cec309bb214c849c5c7df
          domain: switch
    - conditions:
      - condition: numeric_state
        entity_id: sensor.icemaker_water_temperature
        above: input_number.ice_maker_water_high_temperature_threshold
      sequence:
      - if:
        - condition: device
          type: is_off
          device_id: 996ea9226cbd0c2fe7ddb21af32045f9
          entity_id: 9dc6d48cc35cec309bb214c849c5c7df
          domain: switch
        then:
        - type: turn_on
          device_id: 996ea9226cbd0c2fe7ddb21af32045f9
          entity_id: 9dc6d48cc35cec309bb214c849c5c7df
          domain: switch
        - delay:
            hours: 0
            minutes: 15
            seconds: 0
            milliseconds: 0
        - type: turn_off
          device_id: 996ea9226cbd0c2fe7ddb21af32045f9
          entity_id: 9dc6d48cc35cec309bb214c849c5c7df
          domain: switch
    default:
    - type: turn_off
      device_id: 996ea9226cbd0c2fe7ddb21af32045f9
      entity_id: 9dc6d48cc35cec309bb214c849c5c7df
      domain: switch
  mode: restart
- id: '1626459943924'
  alias: Water on off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.button_1
    from: 'on'
    to: 'off'
  - platform: state
    entity_id:
    - switch.button_1
    from: 'off'
    to: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.button_1
        state: 'on'
      sequence:
      - service: switch.turn_on
        target:
          entity_id: switch.back_garden_irrigation_valve
        data: {}
    - conditions:
      - condition: state
        entity_id: switch.button_1
        state: 'off'
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.back_garden_irrigation_valve
        data: {}
    default: []
  mode: single
- id: '1634179399421'
  alias: Notify when Lucy leaves her pump at home
  description: ''
  trigger:
  - platform: state
    entity_id:
    - person.lucy
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 10
      seconds: 0
    enabled: true
  condition:
  - condition: zone
    entity_id: device_tracker.insulin_pump_controller
    zone: zone.home
  action:
  - data:
      message: Lucy's Insulin pump controller may have been left at Home!
      data:
        color: red
        channel: PumpController
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:pump
      title: Pump Controller
    action: notify.mobile_app_rich_mob_app
  - data:
      message: Lucy Pump Controller was left at Home!
    action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1635187432504'
  alias: Outside Lights Motion Slow Fade
  description: Main Lights Profile
  triggers:
  - type: motion
    device_id: 99689212065c11ebbd2ecbef1587dfe1
    entity_id: binary_sensor.drive_high_16_vmd4_camera1profile3
    domain: binary_sensor
    trigger: device
    enabled: false
  - type: opened
    device_id: 86b815b15cbf84a75984db3b46f6cc17
    entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
    domain: binary_sensor
    trigger: device
  - type: occupied
    device_id: a4d9035dcf8d5c8cad4f0a74d46b0c86
    entity_id: c0aa981ae14899cc5d0ad845e5dfddb9
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: 00:00:00
      before_offset: -00:30:00
      before: sunrise
    - condition: sun
      before: sunrise
      before_offset: -00:30:00
      enabled: false
  actions:
  - choose:
    - conditions:
      - condition: time
        after: input_datetime.outside_lights_late_night_start_time
        before: input_datetime.outside_lights_late_night_end_time
      sequence:
      - target:
          entity_id:
          - light.outside_1_down
          - light.outside_2_down
          - light.outside_3_down
          - light.outside_4_down
          - light.outside_5_down
        data:
          brightness_pct: '{{ states(''input_number.outside_lights_late_night_brightness'')
            | int(0) }}'
          color_temp: 370
          transition: 5
        action: light.turn_on
      - delay:
          minutes: '{{ states(''input_number.outside_lights_late_night_time_on_minutes'')
            | int(0) }}'
    default:
    - target:
        entity_id:
        - light.outside_1_down
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_2_down
      data:
        color_temp: 370
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_3_down
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_4_down
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_5_down
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_4_up
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_3_up
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_2_up
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        milliseconds: '{{ states(''input_number.outside_lights_early_night_time_between_lights_milliseconds'')
          | int(0) }}'
    - target:
        entity_id:
        - light.outside_1_up
      data:
        brightness_pct: '{{ states(''input_number.outside_lights_early_night_brightness'')
          | int(0) }}'
        transition: '{{ states(''input_number.outside_lights_early_night_per_light_transition_time_seconds'')
          | int(0) }}'
      action: light.turn_on
    - delay:
        minutes: '{{ states(''input_number.outside_lights_early_night_time_on_minutes'')
          | int(0) }}'
  - target:
      entity_id:
      - light.outside_1_up
      - light.outside_1_down
      - light.outside_2_up
      - light.outside_2_down
      - light.outside_3_up
      - light.outside_3_down
      - light.outside_4_up
      - light.outside_4_down
      - light.outside_5_down
    data:
      transition: 20
    action: light.turn_off
  - if:
    - condition: time
      after: '16:00:00'
    - condition: time
      before: '23:00:00'
    then:
    - delay:
        hours: 0
        minutes: 0
        seconds: 2
        milliseconds: 0
    - target:
        entity_id: light.outside_2_down
      data:
        color_temp: 250
        brightness_pct: 1
      action: light.turn_on
  mode: restart
- id: '1652210144322'
  alias: House Doorbell - Local Notify
  description: CCTV needs to have anonymous viewer enabled or I need to pass the username
    in the media_content_id. Note, during testing you need to turn off the media_player
    device after each test, else is will not show the video again. (local media-source
    is 30 seconds behind!)
  triggers:
  - type: turned_on
    device_id: b03ab12c707340e8849888171a79caed
    entity_id: 7c6911b35b21b35fae0f55d88984a7d9
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: or
    conditions:
    - condition: zone
      entity_id: person.richard
      zone: zone.home
    - condition: zone
      entity_id: person.lucy
      zone: zone.home
  actions:
  - data:
      message: Front door
    action: notify.google_assistant_sdk
  - data: {}
    target:
      entity_id:
      - media_player.office_display
      - media_player.living_room_display
      - media_player.kitchen_display
      - media_player.dining_room_display
    enabled: false
    action: media_player.turn_off
  - data:
      message: Ding! Dong! Someone is at the door
      target:
      - bathroom_speaker
      - garage
      - guest_bedroom
      - bedroom
    enabled: false
    action: notify.google_assistant_sdk
  - target:
      entity_id: media_player.office_display
    data:
      media:
        media_content_id: media-source://camera/camera.p3265_lv_0
        media_content_type: application/vnd.apple.mpegurl
        metadata:
          title: Front Door .11
          thumbnail: /api/camera_proxy/camera.p3265_lv_0
          media_class: video
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://camera
    enabled: false
    action: media_player.play_media
  - target:
      entity_id: media_player.living_room_display
    data:
      media:
        media_content_id: media-source://camera/camera.p3265_lv_0
        media_content_type: application/vnd.apple.mpegurl
        metadata:
          title: Front Door .11
          thumbnail: /api/camera_proxy/camera.p3265_lv_0
          media_class: video
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://camera
    enabled: false
    action: media_player.play_media
  - target:
      entity_id: media_player.dining_room_display
    data:
      media:
        media_content_id: media-source://camera/camera.drive_high_16
        media_content_type: application/vnd.apple.mpegurl
        metadata:
          title: Drive High .16
          thumbnail: /api/camera_proxy/camera.drive_high_16
          media_class: video
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://camera
    enabled: false
    action: media_player.play_media
  - target:
      entity_id: media_player.kitchen_display
    data:
      media:
        media_content_id: media-source://camera/camera.p3265_lv_0
        media_content_type: application/vnd.apple.mpegurl
        metadata:
          title: Front Door .11
          thumbnail: /api/camera_proxy/camera.p3265_lv_0
          media_class: video
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://camera
    enabled: false
    action: media_player.play_media
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
    enabled: false
  - parallel:
    - data:
        media:
          media_content_id: http://192.168.4.11/axis-cgi/mjpg/video.cgi
          media_content_type: image/jpg
          metadata: {}
      target:
        entity_id:
        - media_player.office_display
        - media_player.living_room_display
        - media_player.kitchen_display
      enabled: false
      action: media_player.play_media
    - data:
        media:
          media_content_id: media-source://camera/camera.p3265_lv_0
          media_content_type: application/vnd.apple.mpegurl
          metadata: {}
      target:
        entity_id:
        - media_player.office_display
        - media_player.living_room_display
        - media_player.kitchen_display
      enabled: false
      action: media_player.play_media
    - data:
        format: hls
        media_player: media_player.office_display
      target:
        entity_id: camera.p3265_lv_0_onvif_video
      enabled: false
      action: camera.play_stream
    - data:
        media_player: media_player.dining_room_display
        format: hls
      enabled: false
      action: camera.play_stream
      target:
        device_id: f0e1997868917ad16e3663a3ac05f1e6
    - data:
        format: hls
        media_player: media_player.office_display
      target:
        entity_id:
        - camera.p3265_lv_0
      enabled: false
      action: camera.play_stream
    - data:
        message: Ding! Dong! Someone is at the door
        entity_id: media_player.bathroom_speaker, media_player.garage, media_player.guest_bedroom
        cache: true
      enabled: false
      action: tts.google_translate_say
    - data:
        message: Ding! Dong! Someone is at the door
        target:
        - bathroom_speaker
        - garage
        - guest_bedroom
        - bedroom
      action: notify.google_assistant_sdk
    - target:
        entity_id: media_player.living_room_display
      data:
        media:
          media_content_id: media-source://camera/camera.p3265_lv_0
          media_content_type: application/vnd.apple.mpegurl
          metadata:
            title: Front Door .11
            thumbnail: /api/camera_proxy/camera.p3265_lv_0
            media_class: video
            children_media_class:
            navigateIds:
            - {}
            - media_content_type: app
              media_content_id: media-source://camera
            browse_entity_id: media_player.living_room_display
      action: media_player.play_media
    - target:
        entity_id: media_player.dining_room_display
      data:
        media:
          media_content_id: media-source://camera/camera.p3225_lve_mk_ii_0
          media_content_type: application/vnd.apple.mpegurl
          metadata:
            title: Front Garden .27
            thumbnail: /api/camera_proxy/camera.p3225_lve_mk_ii_0
            media_class: video
            children_media_class:
            navigateIds:
            - {}
            - media_content_type: app
              media_content_id: media-source://camera
            browse_entity_id: media_player.dining_room_display
      action: media_player.play_media
    - target:
        entity_id: media_player.office_display
      data:
        media:
          media_content_id: media-source://camera/camera.p3265_lv_0
          media_content_type: application/vnd.apple.mpegurl
          metadata:
            title: Front Door .11
            thumbnail: /api/camera_proxy/camera.p3265_lv_0
            media_class: video
            children_media_class:
            navigateIds:
            - {}
            - media_content_type: app
              media_content_id: media-source://camera
            browse_entity_id: media_player.office_display
      enabled: true
      action: media_player.play_media
    - target:
        entity_id: media_player.kitchen_display
      data:
        media:
          media_content_id: media-source://camera/camera.p3265_lv_0
          media_content_type: application/vnd.apple.mpegurl
          metadata:
            title: Front Door .11
            thumbnail: /api/camera_proxy/camera.p3265_lv_0
            media_class: video
            children_media_class:
            navigateIds:
            - {}
            - media_content_type: app
              media_content_id: media-source://camera
            browse_entity_id: media_player.kitchen_display
      action: media_player.play_media
    enabled: false
  mode: single
- id: '1661547535107'
  alias: Kitchen Lights Motion Automation
  description: Triggered in motion, restarted on fresh motion detection (sensors set
    to 90 second timeout). On timer delay turn-off section, checks if motion is still
    being detected, to avoid issue with motion being continuity detected for entire
    delay period (otherwise lights would turn off, as no new motion events had been
    generated, even though motion is still true). Could set the automation to only
    turn off lights when no motion is detected, but this may risk the lights staying
    on all the time if off-motion event is not triggered.
  triggers:
  - type: occupied
    device_id: ae2a09aff2b5e7ef8155aa0aea2ae997
    entity_id: 7183e77199aa9682d16c03a011352ead
    domain: binary_sensor
    trigger: device
  - type: occupied
    device_id: 8f93f025843a9a3da3c079739843e408
    entity_id: 396dab2b22de1017ada5e53201d6abe0
    domain: binary_sensor
    trigger: device
  - event_type: kitchen_occupied
    trigger: event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: time
        after: 02:00:00
        before: 07:00:00
      sequence:
      - data:
          transition: 2
          brightness_pct: 75
        target:
          device_id: 061e0dd32d43fd2355543b4f4db149ac
        action: light.turn_on
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
      - choose:
        - conditions:
          - condition: or
            conditions:
            - type: is_motion
              condition: device
              device_id: ae2a09aff2b5e7ef8155aa0aea2ae997
              entity_id: binary_sensor.kitchen_motion_sensor_1_occupancy
              domain: binary_sensor
            - type: is_motion
              condition: device
              device_id: 8f93f025843a9a3da3c079739843e408
              entity_id: binary_sensor.kitchen_motion_sensor_2_occupancy
              domain: binary_sensor
          sequence:
          - event: kitchen_occupied
            event_data: {}
        default:
        - data:
            transition: 20
          action: light.turn_off
          target:
            device_id: c8b85bb0a92c1f69c117b9217a6c86a8
    default:
    - data:
        transition: 2
        brightness_pct: 100
      action: light.turn_on
      target:
        device_id: c8b85bb0a92c1f69c117b9217a6c86a8
    - delay:
        hours: 0
        minutes: 15
        seconds: 0
        milliseconds: 0
    - choose:
      - conditions:
        - condition: or
          conditions:
          - type: is_occupied
            condition: device
            device_id: ae2a09aff2b5e7ef8155aa0aea2ae997
            entity_id: 7183e77199aa9682d16c03a011352ead
            domain: binary_sensor
          - type: is_occupied
            condition: device
            device_id: 8f93f025843a9a3da3c079739843e408
            entity_id: 396dab2b22de1017ada5e53201d6abe0
            domain: binary_sensor
        sequence:
        - event: kitchen_occupied
          event_data: {}
      default:
      - data:
          transition: 20
        action: light.turn_off
        target:
          device_id: c8b85bb0a92c1f69c117b9217a6c86a8
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          device_id:
          - 4e30ea946a5495f14d38b994caec1da0
  mode: restart
- id: '1667142302076'
  alias: Smoke Machine Automation - Reset Switch
  description: Remote is "Off" only, so this resets the switch back to "On"
  trigger:
  - platform: state
    entity_id:
    - switch.smoke_machine
    to: 'off'
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.smoke_machine
    enabled: false
  mode: single
- id: '1671628022949'
  alias: Christmas Lights Timer
  description: ''
  triggers:
  - event: sunset
    id: 'ON'
    trigger: sun
    offset: -00:20:00
  - at: '23:30:00'
    id: 'OFF'
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: 'ON'
      sequence:
      - data: {}
        target:
          entity_id:
          - light.christmas_tree_lights
        action: light.turn_on
      - data: {}
        target:
          entity_id:
          - light.christmas_garden_lights
        action: light.turn_on
    - conditions:
      - condition: trigger
        id: 'OFF'
      sequence:
      - data: {}
        action: light.turn_off
        target:
          entity_id:
          - light.christmas_tree_lights
      - data: {}
        action: light.turn_off
        target:
          entity_id:
          - light.christmas_garden_lights
  mode: single
- id: '1689364304362'
  alias: Irrigation Notify When Controllers Goes Offline
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ic_back_status
    to:
    from: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - platform: state
    entity_id:
    - binary_sensor.ic_front_status
    to:
    from: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition: []
  action:
  - service: notify.mobile_app_rich_mob_app
    data:
      message: Irrigation Controller Offline
      data:
        channel: Irrigation
        importance: default
        visibility: public
        notification_icon: mdi:water-alert-outline
    enabled: true
  mode: queued
- id: '1694715667268'
  alias: Parcel Box Opened Notify - Rev 2
  description: Take photo first, rather than using camera_proxy, as camera_proxy only
    takes the image when the notification is delivered, which may be later if signal
    is poor.
  triggers:
  - type: opened
    device_id: 2aadd916ad46270ecda5ab407a461e6c
    entity_id: binary_sensor.parcel_box_contact
    domain: binary_sensor
    enabled: false
    trigger: device
  - entity_id:
    - binary_sensor.parcel_box_contact
    from: 'off'
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - data:
      title: Parcel Box
      message: Parcel Box Opened
      data:
        image: /api/camera_proxy/camera.garage_32_accc8e9a8378
        color: green
        channel: ParcelBox1
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: default
        timeout: 86400
        visibility: public
        notification_icon: mdi:package-variant-closed
    action: notify.mobile_app_rich_mob_app
  - data:
      title: Parcel Box
      message: Parcel Box Opened
      data:
        image: /api/camera_proxy/camera.garage_32_accc8e9a8378
        color: green
        channel: ParcelBox1
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: default
        timeout: 86400
        visibility: public
        notification_icon: mdi:package-variant-closed
    action: notify.mobile_app_lucy_mob_app
  - data:
      title: Parcel Box
      message: Parcel Box Opened Photo 2
      data:
        image: /api/camera_proxy/camera.p3224_lve_0
        color: green
        channel: ParcelBox2
        importance: default
        timeout: 86400
        visibility: public
        notification_icon: mdi:package-variant-closed
        sticky: 'true'
    action: notify.mobile_app_rich_mob_app
  - data:
      title: Parcel Box
      message: Parcel Box Opened Photo 2
      data:
        image: /api/camera_proxy/camera.p3224_lve_0
        color: green
        channel: ParcelBox2
        importance: default
        timeout: 86400
        visibility: public
        notification_icon: mdi:package-variant-closed
        sticky: 'true'
    action: notify.mobile_app_lucy_mob_app
  - data:
      message: Parcel Box Opened
    enabled: true
    action: notify.google_assistant_sdk
  mode: single
- id: '1694727006658'
  alias: House Doorbell - External Notify
  description: Take photo first, rather than using camera_proxy, as camera_proxy only
    takes the image when the notification is delivered, which may be later if signal
    is poor.
  triggers:
  - type: turned_on
    device_id: b03ab12c707340e8849888171a79caed
    entity_id: 7c6911b35b21b35fae0f55d88984a7d9
    domain: binary_sensor
    trigger: device
  conditions: []
  actions:
  - parallel:
    - if:
      - condition: state
        entity_id: sensor.rich_mob_app_ringer_mode
        state: normal
      - condition: state
        entity_id: sensor.rich_mob_app_do_not_disturb_sensor
        state: 'off'
      - condition: state
        entity_id: sensor.rich_mob_app_phone_state
        state: idle
        enabled: false
      then:
      - data:
          data:
            channel: DoorbellTTS2
            importance: high
            visibility: public
            tts_text: Ding Dong Doorbell
            media_stream: alarm_stream_max
            ttl: 0
            priority: high
          message: TTS
        action: notify.mobile_app_rich_mob_app
    - if:
      - condition: state
        entity_id: sensor.lucy_mob_app_ringer_mode
        state: normal
      - condition: state
        entity_id: sensor.lucy_mob_app_do_not_disturb_sensor
        state: 'off'
      - condition: state
        entity_id: sensor.lucy_mob_app_phone_state
        state: idle
        enabled: false
      then:
      - data:
          data:
            channel: DoorbellTTS2
            importance: high
            visibility: public
            tts_text: Ding Dong Doorbell
            media_stream: alarm_stream_max
            ttl: 0
            priority: high
          message: TTS
        action: notify.mobile_app_lucy_mob_app
  - parallel:
    - data:
        data:
          image: /api/camera_proxy/camera.p3265_lv_0
          color: red
          channel: Doorbell
          vibrationPattern: 100,200,100,100,75,25,100,200,100,500,100,200,100,500
          importance: high
          timeout: 86400
          visibility: public
          notification_icon: mdi:door
          ttl: 0
          priority: high
          sticky: 'true'
        message: ' Timestamp: {{now().strftime(''%Y-%m-%d %I:%M %p'')}}'
        title: Doorbell
      action: notify.mobile_app_rich_mob_app
    - data:
        data:
          image: /api/camera_proxy/camera.p3265_lv_0
          color: red
          channel: Doorbell
          vibrationPattern: 100,200,100,100,75,25,100,200,100,500,100,200,100,500
          importance: high
          timeout: 86400
          visibility: public
          notification_icon: mdi:door
          ttl: 0
          priority: high
          sticky: 'true'
        message: ' Timestamp: {{now().strftime(''%Y-%m-%d %I:%M %p'')}}'
        title: Doorbell
      action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1694790204906'
  alias: Front door opened with no one home
  description: ''
  triggers:
  - type: opened
    device_id: 86b815b15cbf84a75984db3b46f6cc17
    entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.richard
      zone: zone.home
    - condition: zone
      entity_id: person.lucy
      zone: zone.home
    enabled: true
  actions:
  - data:
      title: Front Door
      message: Door opened, but no one is home!
      data:
        image: /api/camera_proxy/camera.p3265_lv_0
        color: red
        channel: DoorOpen1
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:door
    action: notify.mobile_app_rich_mob_app
  - data:
      title: Front Door
      message: Door opened, but no one is home!
      data:
        image: /api/camera_proxy/camera.p3265_lv_0
        color: red
        channel: DoorOpen1
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:door
    action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1694795158536'
  alias: Back door opened but no one is home
  description: ''
  triggers:
  - type: opened
    device_id: dd6c9ee012d55a6e6f1b0ef375270d86
    entity_id: 3cd6c236c41a010470145e104bd7f36f
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.richard
      zone: zone.home
    - condition: zone
      entity_id: person.lucy
      zone: zone.home
    enabled: true
  actions:
  - data:
      title: Back Door
      message: Back door opened, but no one is home!
      data:
        image: /api/camera_proxy/camera.p3225_lv_mk_ii_1
        color: red
        channel: BackDoorOpen
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:door
    action: notify.mobile_app_rich_mob_app
    enabled: true
  - data:
      title: Back Door
      message: Back door opened, but no one is home!
      data:
        image: /api/camera_proxy/camera.p3225_lv_mk_ii_1
        color: red
        channel: BackDoorOpen
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:door
    action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1696178796762'
  alias: Living Room TV Speakers Auto On-Off
  description: 'Turn on living room speakers when Samsung Smart TV is turned on.

    '
  triggers:
  - type: changed_states
    device_id: 99a89cc7d2a737c382a99397821a0522
    entity_id: bff78da4f1f7d24e59e81c86729d0ceb
    domain: media_player
    trigger: device
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: device
        device_id: 99a89cc7d2a737c382a99397821a0522
        domain: media_player
        entity_id: bff78da4f1f7d24e59e81c86729d0ceb
        type: is_on
      sequence:
      - data: {}
        target:
          device_id: 8c3077e0600e4f78a7427ec178ee4e36
        action: switch.turn_on
    - conditions:
      - condition: device
        device_id: 99a89cc7d2a737c382a99397821a0522
        domain: media_player
        entity_id: bff78da4f1f7d24e59e81c86729d0ceb
        type: is_off
      sequence:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
        alias: Delay to avoid bouncing off and on
      - data: {}
        target:
          device_id: 8c3077e0600e4f78a7427ec178ee4e36
        action: switch.turn_off
    enabled: true
  mode: restart
- id: '1697309989912'
  alias: Lucy Location Watchdog
  description: Lucy has no mobile data on her phone, so when she is away without wifi,
    the location automations at home will continue to think she is at home, causing
    issues. This automation sets Lucy as away after a time of no location updates,
    to ensure the automations work.
  trigger:
  - platform: template
    value_template: '{% if ((as_timestamp( now()) - as_timestamp(states.person.lucy.last_updated))
      | int) > 1200 %}true{% endif %}'
  condition:
  - condition: template
    value_template: '{% if ((as_timestamp( now()) - as_timestamp(states.person.lucy.last_updated))
      | int) > 1200 %}true{% endif %}'
  action:
  - service: device_tracker.see
    data:
      dev_id: google_maps_114635444798949098363
      location_name: not_home
  mode: single
- id: '1697311341807'
  alias: Turn on hallway lights for a moment when we get home
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 86b815b15cbf84a75984db3b46f6cc17
    entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
    domain: binary_sensor
  condition:
  - condition: sun
    after: sunset
    after_offset: 00:30
    before: sunrise
  action:
  - service: light.turn_on
    data:
      transition: 20
      kelvin: 2700
    target:
      device_id: 0e1ed242a4670cea76f671cc12039968
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - choose:
    - conditions:
      - type: is_open
        condition: device
        device_id: 86b815b15cbf84a75984db3b46f6cc17
        entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
        domain: binary_sensor
      sequence:
      - wait_for_trigger:
        - type: not_opened
          platform: device
          device_id: 86b815b15cbf84a75984db3b46f6cc17
          entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
          domain: binary_sensor
        timeout:
          hours: 0
          minutes: 30
          seconds: 0
          milliseconds: 0
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.downstairs_hallway_light
    - conditions:
      - type: is_not_open
        condition: device
        device_id: 86b815b15cbf84a75984db3b46f6cc17
        entity_id: f0cb1ec8ad721e92bd29b0684af17fe6
        domain: binary_sensor
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.downstairs_hallway_light
    enabled: false
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.downstairs_hallway_light
  mode: restart
- id: '1697311647945'
  alias: Garage door opened but no one is home
  description: ''
  triggers:
  - type: opened
    device_id: 6d3f659d3b1cf6534dc09fa4fcca868d
    entity_id: 17edc1d1385c61490d54f583bbb34c2b
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.richard
      zone: zone.home
    - condition: zone
      entity_id: person.lucy
      zone: zone.home
    enabled: true
  actions:
  - data:
      filename: /media/garage_sensor.jpg
    action: camera.snapshot
    target:
      device_id: 7b90f64243d21822c3e6bbfc339fad0a
    enabled: false
  - data:
      title: Garage Door
      message: Garage Door opened, but no one is home!
      data:
        image: /api/camera_proxy/camera.p3224_lve_0
        color: red
        channel: DoorOpen3
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:door
    action: notify.mobile_app_rich_mob_app
  - data:
      title: Garage Door
      message: Garage Door opened, but no one is home!
      data:
        image: /api/camera_proxy/camera.p3224_lve_0
        color: red
        channel: DoorOpen3
        vibrationPattern: 100,200,100,200,100,200,100,200
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:door
    action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1697388186314'
  alias: Energenie eTRV Error Handler
  description: ''
  triggers:
  - type: problem
    device_id: a46ff2f2479fd7381a267a77a12734ae
    entity_id: cb5fcb489d2672ac9dad67779d1b5c08
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: e79922e5a787ed8db81ee253715ea823
    entity_id: 240181bd9a3ee5f41a115bad8769841b
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: 061f81b04836d8e074d7e2542b21767c
    entity_id: a050971712c4335b998b67489b3e07b8
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: 55d26468639a4f1005742215878de937
    entity_id: c8108715bdfc512a18dfbbe5124bee96
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: f694a04cab17376f9ccbb97b67b6365d
    entity_id: a1222f8d5b3d6a922a9e71ab061f2292
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: 9fb3ba0a224918b6c1b43afbcc3c1f23
    entity_id: 8e53453c39e12d27442ff5b35a6deced
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: d87bf9712abd725b400a815405c374ac
    entity_id: 7065503bc93ebbeb606463976d04f999
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: 71e963eadf1071d0f777742a6fbb5cf9
    entity_id: fc32779959e9512a07e24e50efad3521
    domain: binary_sensor
    trigger: device
  - type: problem
    device_id: a9d1acaaf374a3234065ce3dca7d9f04
    entity_id: 0e45a0c11ea5c5863f199013dec69f52
    domain: binary_sensor
    trigger: device
  conditions: []
  actions:
  - data:
      title: Energenie eTRV Error
      message: Energenie eTRV Error. This was triggered by {{ trigger.id }}
      data:
        color: red
        channel: EnergenieeTRVError
        vibrationPattern: 100,200,100,200,100,200,100,200
        visibility: public
        notification_icon: mdi:alert-circle-outline
    action: notify.mobile_app_rich_mob_app
  mode: single
- id: '1697572691572'
  alias: Simulate Presence Lights When Away
  description: Automation Simulate Presence / Occupancy Simulation. Runs single and
    if we get home it will turn off all the lights (cancel the run)
  triggers:
  - event_type: event_simulate_presence_loop
    trigger: event
    enabled: true
  - event: sunset
    offset: +00:30:00
    trigger: sun
  - entity_id:
    - person.richard
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: state
  - entity_id:
    - person.lucy
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 20
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.simulate_presence_enable
    state: 'on'
    enabled: false
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: time
    enabled: true
    before: 01:30:00
    after: '14:00:00'
  - condition: state
    entity_id: person.richard
    state: not_home
  - condition: state
    entity_id: person.lucy
    state: not_home
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.presence_simulation_lights_group
    alias: 'Perform action ''Light: Turn off'' - Do this first in case the automation
      gets restarted'
  - delay:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
    alias: Wait for RF to send commands
  - data_template:
      entity_id: '{{ state_attr(''light.presence_simulation_lights_group'', ''entity_id'')
        | random }}'
    action: light.turn_on
    alias: 'Light: Turn on - Select light at random from light group'
  - delay:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
    alias: Wait for RF to send commands
  - delay: 00:{{ (range(10, 30) | random) }}:00
    alias: Delay for random amount of time
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.presence_simulation_lights_group
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.presence_simulation_lights_group
    alias: 'Perform action ''Light: Turn off'' - Do this first in case the automation
      gets restarted'
  - delay:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
    alias: Wait for RF to send commands
  - event: event_simulate_presence_loop
    enabled: true
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id: automation.simulate_presence_lights_dev
    enabled: false
  mode: restart
- id: '1702742847276'
  alias: Office Blinds Schedule + Remote Control
  description: "Opens in the morning, only if Richard is home. \nCloses in the evening
    at dusk.\n\nEdited to open at sunrise even if Richard isn't home so the office
    plants get some sunlight."
  triggers:
  - at: 09:00:00
    id: open
    trigger: time
    enabled: false
  - domain: mqtt
    device_id: ca61296154562d84a7271001aba10aa5
    type: action
    subtype: open
    trigger: device
    id: open
  - event: sunrise
    id: open
    trigger: sun
    offset: +00:00:00
  - event: sunset
    id: close
    trigger: sun
    offset: +00:30:00
  - domain: mqtt
    device_id: ca61296154562d84a7271001aba10aa5
    type: action
    subtype: close
    trigger: device
    id: close
  - domain: mqtt
    device_id: ca61296154562d84a7271001aba10aa5
    type: action
    subtype: stop
    trigger: device
    id: stop
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - close
      sequence:
      - target:
          device_id: 32f5bc90bdea3d225d1abb66083405ac
        data: {}
        action: cover.close_cover
    - conditions:
      - condition: trigger
        id:
        - open
      - condition: zone
        entity_id: person.richard
        zone: zone.home
        enabled: false
      sequence:
      - data: {}
        action: cover.open_cover
        target:
          device_id: 32f5bc90bdea3d225d1abb66083405ac
    - conditions:
      - condition: trigger
        id:
        - stop
      sequence:
      - action: cover.stop_cover
        target:
          device_id:
          - 32f5bc90bdea3d225d1abb66083405ac
        data: {}
  mode: single
- id: '1705695753761'
  alias: Bathroom Audio Remote - Google Home Speaker
  description: 'Triggered by an IKEA five-button Zigbee remote through zigbee2mqtt,
    this automation controls the Bluetooth functionality of a Google Home/Nest Mini
    speaker.


    Due to limitations in Home Assistant, direct control of a Google Home/Nest speaker''s
    Bluetooth is not possible. To circumvent this, a toggle "helper" is employed,
    acting as a trigger within a Google Home Automation to react to changes in the
    toggle''s state and controls the Bluetooth state.


    Once my phone is Bluetooth-paired to the Google Home/Nest speaker, volume control
    commands issued to the speaker through Home Assistant are seamlessly relayed to
    the phone. However, it''s important to note that these commands are presently
    limited to pause and volume adjustments within Home Assistant, even though voice
    commands can be used to control next/previous track functions. This is a limitation
    of Google Home/Nest Mini, next/previous track works with Home Home/Nest Hubs just
    fine.'
  trigger:
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: brightness_up_click
    discovery_id: 0x000b57fffe38a445 action_brightness_up_click
    id: up_click
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: brightness_down_click
    discovery_id: 0x000b57fffe38a445 action_brightness_down_click
    id: down_click
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: toggle
    discovery_id: 0x000b57fffe38a445 action_toggle
    id: middle_click
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: arrow_left_click
    discovery_id: 0x000b57fffe38a445 action_arrow_left_click
    id: left_click
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: arrow_right_click
    discovery_id: 0x000b57fffe38a445 action_arrow_right_click
    id: right_click
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: brightness_up_hold
    discovery_id: 0x000b57fffe38a445 action_brightness_up_hold
    id: hold_up
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: arrow_left_hold
    discovery_id: 0x000b57fffe38a445 action_arrow_left_hold
    id: hold_left
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: arrow_right_hold
    discovery_id: 0x000b57fffe38a445 action_arrow_right_hold
    id: hold_right
  - platform: device
    domain: mqtt
    device_id: 18318fe5e7eaecbbd0d63380720d9706
    type: action
    subtype: brightness_down_hold
    discovery_id: 0x000b57fffe38a445 action_brightness_down_hold
    id: hold_down
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - up_click
      sequence:
      - service: media_player.volume_up
        metadata: {}
        data: {}
        target:
          device_id: 30e5174b145711eb88da47ba37409372
    - conditions:
      - condition: trigger
        id:
        - down_click
      sequence:
      - service: media_player.volume_down
        metadata: {}
        data: {}
        target:
          device_id: 30e5174b145711eb88da47ba37409372
    - conditions:
      - condition: trigger
        id:
        - middle_click
      sequence:
      - service: media_player.media_play_pause
        metadata: {}
        data: {}
        target:
          device_id: 30e5174b145711eb88da47ba37409372
    - conditions:
      - condition: trigger
        id:
        - left_click
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.bathroom_audio_remote_proxy_bridge_for_google_assistant
    - conditions:
      - condition: trigger
        id:
        - right_click
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.bathroom_audio_remote_proxy_bridge_for_google_assistant
    - conditions:
      - condition: trigger
        id:
        - hold_up
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.bathroom_audio_remote_proxy_bridge_for_google_assistant
        enabled: false
    - conditions:
      - condition: trigger
        id:
        - hold_down
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.bathroom_audio_remote_proxy_bridge_for_google_assistant
        enabled: false
  mode: single
- id: '1708473467198'
  alias: Living Room Fairy Lights Follow Other Lights
  description: ''
  triggers:
  - type: turned_on
    device_id: 6e0ded4c47c76900af05e933f9348a46
    entity_id: 020edf627efb532c118e3a6362fbc1a4
    domain: light
    id: 'on'
    trigger: device
  - type: turned_off
    device_id: 6e0ded4c47c76900af05e933f9348a46
    entity_id: 020edf627efb532c118e3a6362fbc1a4
    domain: light
    id: 'off'
    trigger: device
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.fairy_lights
    - conditions:
      - condition: trigger
        id:
        - 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.fairy_lights
  mode: restart
- id: '1710954157058'
  alias: Pull Water meter data every hour
  description: Warning this will kill the battery if overused
  triggers:
  - minutes: '10'
    trigger: time_pattern
  conditions: []
  actions:
  - metadata: {}
    data: {}
    target:
      entity_id: button.water_meter_request
    action: button.press
  - repeat:
      count: 3
      sequence:
      - metadata: {}
        data: {}
        target:
          entity_id: button.water_meter_request
        action: button.press
      - wait_for_trigger:
        - type: not_running
          device_id: 7e66c8ead1ec91a4eb0011534f720f8e
          entity_id: 587930524e77140f4fffabeaf43a7b1b
          domain: binary_sensor
          trigger: device
        continue_on_timeout: false
    enabled: false
  mode: single
- id: '1714268450987'
  alias: Run off UPS
  description: ''
  trigger:
  - platform: time
    at: 09:40:00
  condition:
  - condition: time
    weekday:
    - sun
  action:
  - type: calibrate_start
    device_id: 2852d68eacdcae952e6fd84251240afb
    domain: nut
  mode: single
- id: '1715801236786'
  alias: Tile Tracker Low Battery Alert
  description: ''
  trigger:
  - platform: time
    at: '11:00:00'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: device_tracker.small_water_bottle
        attribute: last_timestamp
        state: timedelta(days=4)
      - condition: template
        value_template: ' {{ now() - state_attr(''device_tracker.cold_sore_cream'',
          ''last_timestamp'') | as_datetime > timedelta(days=4) }}'
      sequence: []
  mode: single
- id: '1720117742034'
  alias: Tea Brewing Timer
  description: ''
  triggers:
  - domain: mqtt
    device_id: 71d5510f501b15c01210dff88a9c5e31
    type: action
    subtype: 'on'
    trigger: device
    alias: Kitchen Ikea Zigbee Button Pressed
  - alias: Kitchen Ikea Zigbee Button Pressed
    domain: mqtt
    device_id: 71d5510f501b15c01210dff88a9c5e31
    type: action
    subtype: brightness_move_up
    trigger: device
    id: 'Hold Up '
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - 'Hold Up '
    then:
    - repeat:
        count: 2
        sequence:
        - device_id: 061e0dd32d43fd2355543b4f4db149ac
          domain: light
          entity_id: cf6ba794fa1a1a67815ff4de4a57bb2a
          type: flash
    else:
    - repeat:
        count: 1
        sequence:
        - device_id: 061e0dd32d43fd2355543b4f4db149ac
          domain: light
          entity_id: cf6ba794fa1a1a67815ff4de4a57bb2a
          type: flash
  - delay:
      hours: 0
      minutes: 3
      seconds: 30
      milliseconds: 0
  - alias: 'Send to targets separately, to avoid queuing delay '
    parallel:
    - data:
        message: Tea timer, beep! beep!
        target: Dining Room
      enabled: true
      action: notify.google_assistant_sdk
    - data:
        message: Tea timer, beep! beep!
        target: Dining Room
      enabled: true
      action: notify.google_assistant_sdk
    - data:
        message: Tea timer, beep! beep! beep!
        target: kitchen
      enabled: true
      action: notify.google_assistant_sdk
    - data:
        message: Tea timer!
        target: office
      enabled: true
      action: notify.google_assistant_sdk
    enabled: false
  - parallel:
    - repeat:
        count: 1
        sequence:
        - device_id: 061e0dd32d43fd2355543b4f4db149ac
          domain: light
          entity_id: cf6ba794fa1a1a67815ff4de4a57bb2a
          type: flash
    - if:
      - condition: trigger
        id:
        - 'Hold Up '
      then: []
      else:
      - data:
          message: Tea timer, beep! beep! beep!
          target: kitchen
        enabled: true
        action: notify.google_assistant_sdk
      - data:
          message: Tea timer, bing bong dong - bang!
        enabled: true
        action: notify.google_assistant_sdk
  mode: restart
- id: '1720118905430'
  alias: Broadcast dinner almost ready
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 71d5510f501b15c01210dff88a9c5e31
    type: action
    subtype: 'off'
  condition: []
  action:
  - service: notify.google_assistant_sdk
    data:
      message: Dinner is ready.
    enabled: true
  - service: notify.google_assistant_sdk
    data:
      message: Dinner is ready Richard
      target:
      - office
      - living room
      - kichen
      - dining room
    enabled: false
  - service: notify.google_assistant_sdk
    data:
      message: Hello sweetie, dinner is almost ready. Just wanted to let you know.
    enabled: false
  mode: single
- id: '1720571709980'
  alias: Reboot bathroom speaker twice a day
  description: For some reason my Google home seems to get stuck in a loop and becomes
    unresponsive. This automation forces it to reboot as a workaround.
  trigger:
  - platform: time
    at: '11:00:00'
  - platform: time
    at: 00:00:01
  condition:
  - condition: device
    device_id: 30e5174b145711eb88da47ba37409372
    domain: media_player
    entity_id: 92395fa37a44ae46a95d786ecf933dd3
    type: is_off
  action:
  - metadata: {}
    data: {}
    target:
      device_id: 127737e2a86b116da4274dcb735b0349
    action: google_home.reboot_device
  mode: single
- id: '1721088060009'
  alias: Remote control activate bedtime lights
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 26fbc14fff6a78d4c66a9f30fb62938b
    type: action
    subtype: arrow_right_hold
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: scene.turn_on
    metadata: {}
    target:
      entity_id: scene.bedtime_mode
  mode: single
- id: '1722123544585'
  alias: Garden Lights Motion
  description: ''
  triggers:
  - type: opened
    device_id: dd6c9ee012d55a6e6f1b0ef375270d86
    entity_id: 3cd6c236c41a010470145e104bd7f36f
    domain: binary_sensor
    trigger: device
  - type: occupied
    device_id: fa69bc49d4bfe964b899661c045598c2
    entity_id: da0967db8c828ae40c9a359bb2e0436d
    domain: binary_sensor
    trigger: device
    enabled: false
  conditions:
  - condition: sun
    after: sunset
    after_offset: '0'
    before: sunrise
  actions:
  - data:
      kelvin: 2700
      brightness_pct: 100
      transition: 2
    target:
      entity_id: light.garden_lights
    action: light.turn_on
  - repeat:
      until:
      - type: is_not_occupied
        condition: device
        device_id: fa69bc49d4bfe964b899661c045598c2
        entity_id: da0967db8c828ae40c9a359bb2e0436d
        domain: binary_sensor
      sequence:
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
  - data:
      transition: 10
    target:
      device_id: d074b346c18b807df9deee8fe2408e7a
    action: light.turn_off
  mode: restart
- id: '1727031709340'
  alias: 'Trigger bunny food announcement '
  description: ''
  trigger:
  - type: turned_on
    platform: device
    device_id: ddd7697eb54412082fa357f4b4858d2f
    entity_id: bc7ebc36dd87f8aa11180357b95ab0ed
    domain: binary_sensor
    enabled: false
  - platform: state
    entity_id:
    - binary_sensor.bunny_feeder_paf_02_feeding
    from: 'off'
    to: 'on'
  condition: []
  action:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.announce_bunny_food_time
  mode: single
- id: '1732218748464'
  alias: Check Medication Stock - With Location
  description: This automation periodically triggers the pyscript.check_stock script
    to check for medication availability at nearby pharmacies based on the current
    location of person.richard. It retrieves the latitude and longitude from the person.richard
    entity and passes them, along with a configurable search radius, to the script.
  triggers:
  - at: 07:00:00
    trigger: time
  - at: 07:30:00
    trigger: time
  - at: 08:00:00
    trigger: time
  - at: 08:30:00
    trigger: time
  - at: 09:00:00
    trigger: time
  - at: 09:30:00
    trigger: time
  - at: '10:00:00'
    trigger: time
  - at: '10:30:00'
    trigger: time
  - at: '11:00:00'
    trigger: time
  - at: '11:30:00'
    trigger: time
  - at: '12:00:00'
    trigger: time
  - at: '13:30:00'
    trigger: time
  - at: '14:00:00'
    trigger: time
  - at: '14:30:00'
    trigger: time
  - at: '15:00:00'
    trigger: time
  - at: '15:30:00'
    trigger: time
  - at: '16:00:00'
    trigger: time
  - at: '16:30:00'
    trigger: time
  - at: '17:00:00'
    trigger: time
  - at: '17:30:00'
    trigger: time
  - at: '18:00:00'
    trigger: time
  - at: '18:30:00'
    trigger: time
  conditions: []
  actions:
  - data_template:
      base_lat: '{{ state_attr(''person.richard'', ''latitude'') }}'
      base_lon: '{{ state_attr(''person.richard'', ''longitude'') }}'
      distance: 60
    action: pyscript.check_stock
  mode: single
- id: '1732218791930'
  alias: Notify When Medication is in Stock
  description: This automation monitors the sensor.adhd_medication_stock entity, which
    is updated by the pyscript.check_stock script. When the sensor state changes to
    on, indicating that medication is available within the specified distance from
    the current location of person.richard, a notification is sent to the user.
  triggers:
  - entity_id:
    - sensor.adhd_medication_stock
    to: 'on'
    trigger: state
  actions:
  - data:
      data:
        color: blue
        channel: ADHD
        vibrationPattern: 100,500,100,500,100,500,100,500
        importance: high
        visibility: public
        notification_icon: mdi:pill
        ttl: 0
        priority: high
        sticky: 'true'
      message: 'The following stores have stock: {{ state_attr(''sensor.adhd_medication_stock'',
        ''stores'') | map(attribute=''displayName'') | join(''. '') }}

        '
      title: ADHD Medication
    action: notify.mobile_app_rich_mob_app
  mode: single
- id: '1732231906963'
  alias: Notify on Medication Stock Check Failure
  description: Notify if the medication stock check script encounters an error.
  triggers:
  - entity_id:
    - binary_sensor.adhd_medication_check_error
    to: 'on'
    trigger: state
    from: 'off'
  actions:
  - data_template:
      title: Medication Stock Check Error
      message: 'The stock check script failed with the following error: {{ state_attr(''sensor.adhd_medication_stock'',
        ''error'') }}

        '
    action: notify.mobile_app_rich_mob_app
  mode: single
- id: '1734033969313'
  alias: Turn off heating when no one is home
  description: Set the nest target temperature low if no one is home
  triggers:
  - trigger: zone
    entity_id: person.lucy
    zone: zone.home
    event: leave
  - trigger: zone
    entity_id: person.richard
    zone: zone.home
    event: leave
  conditions:
  - condition: not
    conditions:
    - condition: zone
      entity_id: person.lucy
      zone: zone.home
    - condition: zone
      entity_id: person.richard
      zone: zone.home
    alias: Check if anyone is NOT home
  actions:
  - action: climate.set_temperature
    metadata: {}
    data:
      temperature: 10
    target:
      entity_id: climate.hallway
  mode: single
- id: '1736544967218'
  alias: Low battery level detection & notification for all battery sensors [Blueprint]
  description: ''
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      threshold: 15
      day: 6
      time: '18:00:00'
      actions:
      - data:
          data:
            color: purple
            channel: batteries
            visibility: public
            notification_icon: mdi:battery-alert-variant-outline
            ttl: 0
            sticky: 'true'
          message: 'Joined a new Octopus Energy saving session. '
          title: Battery Levels Low
        action: notify.mobile_app_rich_mob_app
      - data:
          title: Battery Low
          message: Battery low {{sensors}}
        action: persistent_notification.create
        enabled: false
- id: '1738459474372'
  alias: Freezer Temperature Alert
  description: ''
  triggers:
  - type: problem
    device_id: 158ed9873a6957601df8faf23e43a98d
    entity_id: e5380eda90a5140965ad71108984ccde
    domain: binary_sensor
    trigger: device
    id: high
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - type: not_connected
    device_id: 158ed9873a6957601df8faf23e43a98d
    entity_id: 8e8427f8efa3902d88b52401f34f1695
    domain: binary_sensor
    trigger: device
    id: offline
    for:
      hours: 0
      minutes: 20
      seconds: 0
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - high
      sequence:
      - data:
          data:
            color: white
            channel: Freezer
            vibrationPattern: 100,500,100,500,100,500,100,500
            importance: high
            visibility: public
            notification_icon: mdi:snowflake-alert
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Top Temperature: {{ states(''sensor.chest_freezer_monitor_top_temperature'')}}
            °C. Bottom: {{ states(''sensor.chest_freezer_monitor_bottom_temperature'')
            }} °C\n Sent: {{now().strftime(''%Y-%m-%d %I:%M %p'')}}

            '
          title: Chest Freezer High Temperature Alert
        action: notify.mobile_app_rich_mob_app
      - data:
          data:
            color: white
            channel: Freezer
            vibrationPattern: 100,500,100,500,100,500,100,500
            importance: high
            visibility: public
            notification_icon: mdi:snowflake-alert
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Top Temperature: {{ states(''sensor.chest_freezer_monitor_top_temperature'')}}
            °C. Bottom: {{ states(''sensor.chest_freezer_monitor_bottom_temperature'')
            }} °C\n Sent: {{now().strftime(''%Y-%m-%d %I:%M %p'')}}

            '
          title: Chest Freezer High Temperature Alert
        action: notify.mobile_app_lucy_mob_app
    - conditions:
      - condition: trigger
        id:
        - offline
      sequence:
      - data:
          data:
            color: white
            channel: Freezer
            vibrationPattern: 100,500,100,500,100,500,100,500
            importance: high
            visibility: public
            notification_icon: mdi:snowflake-alert
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Chest Freezer Monitor is Offline\n Last know Top Temperature:
            {{ states(''sensor.chest_freezer_monitor_top_temperature'')}} °C. Bottom:
            {{ states(''sensor.chest_freezer_monitor_bottom_temperature'') }} °C\n
            Sent: {{now().strftime(''%Y-%m-%d %I:%M %p'')}}

            '
          title: Chest Freezer Offline
        action: notify.mobile_app_rich_mob_app
  mode: single
- id: '1740623037208'
  alias: Lucy Insulin Pump Sensor Watcher
  description: ''
  triggers:
  - type: value
    device_id: c3baec3b4ba49f11d45ef9e1ef28a26b
    entity_id: 562e7d0d1fd3dc62fe7f48f94555d0b1
    domain: sensor
    trigger: device
    below: 10
    enabled: false
  - trigger: time
    at: '23:45:00'
  conditions:
  - type: is_value
    condition: device
    device_id: c3baec3b4ba49f11d45ef9e1ef28a26b
    entity_id: 562e7d0d1fd3dc62fe7f48f94555d0b1
    domain: sensor
    below: 10
  actions:
  - data:
      message: '"Pump sensor will not last the night: {{ states(''sensor.sensor_duration_hours'')
        }} hourls left."

        '
      data:
        color: black
        channel: Pump1
        vibrationPattern: 500,500,500,500,500,500,500,500,500,500,500,500,
        importance: high
        timeout: 86400
        visibility: public
        notification_icon: mdi:pump
        ttl: 0
        priority: high
        sticky: 'true'
      title: ' Pump will not last the night'
    action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1741741446182'
  alias: Lucy Insulin Pump Resuwar Watcher
  description: ''
  triggers: []
  conditions: []
  actions: []
  mode: single
- id: '1742671428912'
  alias: Notify Kitchen Fridge or Freezer Door Left Open
  description: ''
  triggers:
  - type: opened
    device_id: d0b18b2ae1cd529c02498c3649a0a83b
    entity_id: 121fe6faf0b25c0a9d9ad73c4a2ac8f1
    domain: binary_sensor
    trigger: device
    for:
      hours: 0
      minutes: 7
      seconds: 0
    id: Fridge
  - type: opened
    device_id: d0b18b2ae1cd529c02498c3649a0a83b
    entity_id: 20f45ebf12a8541662d2134b4ed8ed30
    domain: binary_sensor
    trigger: device
    for:
      hours: 0
      minutes: 5
      seconds: 0
    id: Freezer
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Fridge
      sequence:
      - data:
          data:
            color: white
            channel: Fridge
            vibrationPattern: 100,100,100,100,100,100,100,100
            importance: high
            visibility: public
            notification_icon: mdi:alert-decagram-outline
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Fridge door left open for 7 mins. Sent: {{now().strftime(''%Y-%m-%d
            %I:%M %p'')}}'
          title: Fridge Door Left Open
        action: notify.mobile_app_rich_mob_app
      - data:
          data:
            color: white
            channel: Fridge
            vibrationPattern: 100,100,100,100,100,100,100,100
            importance: high
            visibility: public
            notification_icon: mdi:alert-decagram-outline
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Fridge door left open for 7 mins Sent: {{now().strftime(''%Y-%m-%d
            %I:%M %p'')}}

            '
          title: Fridge Door Left Open
        action: notify.mobile_app_lucy_mob_app
    - conditions:
      - condition: trigger
        id:
        - Freezer
      sequence:
      - data:
          data:
            color: white
            channel: Freezer
            vibrationPattern: 100,100,100,100,100,100,100,100
            importance: high
            visibility: public
            notification_icon: mdi:alert-decagram-outline
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Freezer door left open for 7 mins Sent: {{now().strftime(''%Y-%m-%d
            %I:%M %p'')}}

            '
          title: Freezer Door Left Open
        action: notify.mobile_app_rich_mob_app
      - data:
          data:
            color: white
            channel: Freezer
            vibrationPattern: 100,100,100,100,100,100,100,100
            importance: high
            visibility: public
            notification_icon: mdi:alert-decagram-outline
            ttl: 0
            priority: high
            sticky: 'true'
          message: 'Freezer door left open for 5 mins Sent: {{now().strftime(''%Y-%m-%d
            %I:%M %p'')}}

            '
          title: Freezer Door Left Open
        action: notify.mobile_app_lucy_mob_app
  mode: single
- id: '1753465748550'
  alias: Publish Meter Data to SDM120CT Emulator via MQTT with Watchdog & Enphase
    Polling
  description: "This automation publishes simulated grid meter data to an MQTT topic,
    emulating a SDM120CT energy meter for inverter integration.\nIt combines data
    from multiple Home Assistant entities to estimate real-time house demand power.
    These include:\n  - sensor.solar_panels_current_net_power_consumption_watts\n
    \ - input_number.inverter_power_offset\n  - input_number.maximum_inverter_power_limit\n
    \ - sensor.storage_battery_power_production\n\nThe logic:\n  1. Measures the home's
    net power.\n  2. Applies a configurable offset (input_number.inverter_power_offset)
    to reduce grid export.\n  3. Subtracts any current inverter output (from battery).\n
    \ 4. Caps the result to the maximum inverter power limit.\n\nThe result is inverted
    (multiplied by -1) because the inverter interprets negative power values as import.
    This helps prioritize battery discharge or minimize grid feed-in.\nThe MQTT payload
    also includes voltage, current, power factor, and frequency to fully emulate the
    energy meter.\nA watchdog trigger ensures a fallback value is sent every 10 minutes
    in case the source sensor goes offline. Additionally, on Home Assistant shutdown,
    it sends a fallback payload to prevent stale data in the inverter.\n⚠️ The fallback
    payload uses a small **simulated grid import** (e.g., -100W). In eco mode, the
    inverter ignores grid imports below 300W — so this prevents the inverter from
    charging or discharging during failure or shutdown. Sending 0W or a positive value
    might cause it to stay active or switch to charge."
  triggers:
  - id: loop
    entity_id: sensor.solar_panels_current_net_power_consumption_watts
    enabled: true
    trigger: state
  - id: watchdog
    minutes: /10
    seconds: 0
    trigger: time_pattern
    enabled: false
  - id: shutdown
    event: shutdown
    trigger: homeassistant
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: loop
      sequence:
      - action: mqtt.publish
        alias: 'Publish MQTT to emulated meter. Note: power is inverted (negative
          = import)'
        data:
          topic: homeassistant/sensor/sdm120ct/meter_data
          payload: "{\n  \"voltage\": \"{{ states('sensor.solar_panels_voltage_net_consumption_ct')
            | float }}\",\n  \"current\": \"{{ (states('sensor.solar_panels_net_consumption_ct_current')
            | float) * -1 }}\",\n  \"activePower\": \"{{ (states('sensor.inverter_demand_power')
            | float) * -1 }}\",\n  \"reactivePower\": \"{{ (states('sensor.solar_panels_reactive_power')
            | float) * -1 }}\",\n  \"powerFactor\": \"{{ states('sensor.solar_panels_powerfactor_net_consumption_ct')
            | float }}\",\n  \"frequency\": \"{{ states('sensor.solar_panels_frequency_production_ct')
            | float }}\"\n}"
        enabled: false
    default:
    - action: button.press
      alias: Send stop signal direct to inverter
      target:
        entity_id: button.stop_current_operation
    - action: mqtt.publish
      alias: Send -100W to inverter (simulated import) to prevent charge or discharge
        in eco mode (below 300W threshold = idle).
      data:
        topic: homeassistant/sensor/sdm120ct/meter_data
        payload: "{\n  \"voltage\": 240,\n  \"current\": -0.42,\n  \"activePower\":
          -100,\n  \"reactivePower\": 0,\n  \"powerFactor\": 1,\n  \"frequency\":
          50\n}"
  mode: single
- id: '1753538167634'
  alias: Enphase Envoy custom local polling interval
  description: ''
  triggers:
  - trigger: time_pattern
    seconds: /6
  conditions: []
  actions:
  - action: homeassistant.update_entity
    metadata: {}
    data:
      entity_id:
      - sensor.solar_panels_current_net_power_consumption
      - sensor.solar_panels_voltage_net_consumption_ct
      - sensor.solar_panels_net_consumption_ct_current
      - sensor.solar_panels_powerfactor_net_consumption_ct
      - sensor.solar_panels_frequency_production_ct
  mode: single
- id: '1755724844350'
  alias: xStorage Home Battery Smart Charging Octopus
  description: 'Intelligently controls Eaton battery charging based on Octopus Energy''s
    Intelligent Go smart dispatching algorithm.

    This works IN ADDITION to the standard night off-peak charging schedule configured
    on the Eaton inverter.


    Smart Logic:

    - Only triggers during active SMART dispatch periods (verified by checking current
    time against planned dispatches)

    - Switches battery to ''Manual Charge'' mode when Octopus''s intelligent algorithm
    determines optimal charging periods

    - Returns battery to ''Maximize Auto Consumption'' when the smart dispatch period
    ends

    '
  triggers:
  - type: turned_off
    device_id: 3912e8bcd9d950c832ebfb154138ce98
    entity_id: 80aa09f400893520a7232726cae46102
    domain: binary_sensor
    trigger: device
    for:
      hours: 0
      minutes: 10
      seconds: 0
  - type: turned_on
    device_id: 3912e8bcd9d950c832ebfb154138ce98
    entity_id: 80aa09f400893520a7232726cae46102
    domain: binary_sensor
    trigger: device
    enabled: true
  conditions: []
  actions:
  - choose:
    - conditions:
      - type: is_on
        condition: device
        device_id: 3912e8bcd9d950c832ebfb154138ce98
        entity_id: 80aa09f400893520a7232726cae46102
        domain: binary_sensor
      - condition: time
        after: 05:40:00
        before: '22:00:00'
      sequence:
      - device_id: 7243064af443eaae599e1a98ef6c25f7
        domain: number
        entity_id: f74d3cb020eaacdeb1fdfe3fbec833bd
        type: set_value
        value: 100
      - device_id: 7243064af443eaae599e1a98ef6c25f7
        domain: number
        entity_id: e7b800d8566a3a708adfb511d30b5344
        type: set_value
        value: 95
      - device_id: 7243064af443eaae599e1a98ef6c25f7
        domain: number
        entity_id: 94221f4692e94c9c394220b9e208ca67
        type: set_value
        value: 2
      - device_id: 7243064af443eaae599e1a98ef6c25f7
        domain: select
        entity_id: 8cb6de227f4654eeee815f12a7579efa
        type: select_option
        option: Manual Charge
    - conditions:
      - type: is_off
        condition: device
        device_id: 3912e8bcd9d950c832ebfb154138ce98
        entity_id: 80aa09f400893520a7232726cae46102
        domain: binary_sensor
      sequence:
      - device_id: 7243064af443eaae599e1a98ef6c25f7
        domain: number
        entity_id: 007c24e6708bab3ee7b727880b5d907a
        type: set_value
        value: 12
      - device_id: 7243064af443eaae599e1a98ef6c25f7
        domain: select
        entity_id: 8cb6de227f4654eeee815f12a7579efa
        type: select_option
        option: Maximize Auto Consumption
  mode: single
- id: '1758208938977'
  alias: Octopus Energy - Auto Set Peak/Off-Peak Tariff
  description: 'Automatically sets tariff based on night rates and Octopus Intelligent
    dispatching.

    '
  triggers:
  - type: turned_on
    device_id: 3912e8bcd9d950c832ebfb154138ce98
    entity_id: 80aa09f400893520a7232726cae46102
    domain: binary_sensor
    trigger: device
    id: Night Off Peak Rate
  - type: turned_off
    device_id: 3912e8bcd9d950c832ebfb154138ce98
    entity_id: 80aa09f400893520a7232726cae46102
    domain: binary_sensor
    trigger: device
    id: Day Peak Rate
  conditions: []
  actions:
  - choose:
    - conditions:
      - type: is_on
        condition: device
        device_id: 3912e8bcd9d950c832ebfb154138ce98
        entity_id: 80aa09f400893520a7232726cae46102
        domain: binary_sensor
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Off-Peak
        target:
          device_id: b76ae102907a3f706f8894e0bcc16a1a
        alias: Set Off-Peak Rate
    - conditions:
      - type: is_off
        condition: device
        device_id: 3912e8bcd9d950c832ebfb154138ce98
        entity_id: 80aa09f400893520a7232726cae46102
        domain: binary_sensor
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Peak
        target:
          device_id: b76ae102907a3f706f8894e0bcc16a1a
        alias: Set Peak Rate
  mode: single
- id: '1759961235381'
  alias: Update SDM120CT Meter Emulator Values
  description: 'Publish values to emulated meter via ESPHome. Note: power is inverted
    (negative = import)

    The only value we really need to send to the inverter is ''Active Power''

    '
  triggers:
  - entity_id:
    - sensor.inverter_demand_power
    trigger: state
  conditions: []
  actions:
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_voltage
    data:
      value: '{{ states(''sensor.solar_panels_voltage_net_consumption_ct'') | float(240)
        }}'
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_frequency
    data:
      value: '{{ states(''sensor.solar_panels_frequency_production_ct'') | float(50.0)
        }}'
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_power_factor
    data:
      value: '{{ states(''sensor.solar_panels_powerfactor_net_consumption_ct'') |
        float(0.97) }}'
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_active_power
    data:
      value: '{{ (states(''sensor.inverter_demand_power'') | float(0)) * -1 }}'
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_apparent_power
    data:
      value: '{% set active = (states(''sensor.inverter_demand_power'') | float(0))
        * -1 %} {% set pf = states(''sensor.solar_panels_powerfactor_net_consumption_ct'')
        | float(0.97) %} {{ (active / pf) | abs if pf != 0 else 0 }}

        '
    enabled: false
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_current
    data:
      value: '{{ (states(''sensor.solar_panels_net_consumption_ct_current'') | float(0))
        * -1 }}'
    enabled: false
  - action: number.set_value
    target:
      entity_id: number.sdm120ct_emulator_reactive_power
    data:
      value: '{{ (states(''sensor.solar_panels_reactive_power'') | float(0)) * -1
        }}'
    enabled: false
  mode: queued
  max: 5
- id: '1760397061139'
  alias: Octopus Energy - Join Saving Session (Custom Actions) [Blueprint]
  description: ''
  use_blueprint:
    path: BottlecapDave/octopus_energy_octoplus_join_saving_session_custom_action.yaml
    input:
      saving_session_event_entity: event.octopus_energy_a_dcb1af4a_octoplus_free_electricity_session_events
      actions:
      - data:
          data:
            color: pink
            channel: octopus
            visibility: public
            notification_icon: mdi:bwind-turbine
            ttl: 0
            sticky: 'true'
          message: 'Joined saving session

            '
          title: Octopus Energy
        action: notify.mobile_app_rich_mob_app
- id: '1762891302927'
  alias: BOTC Microphone Mute State
  description: Triggered by browser userscript when the BOTC app is muted or unmuted
  triggers:
  - webhook_id: botc_mute_state
    trigger: webhook
  actions:
  - variables:
      mute_state: '{{ trigger.json.muted }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ mute_state == true }}'
      sequence:
      - target:
          entity_id: light.desk_lamp
        data:
          color_name: red
          brightness: 255
        action: light.turn_on
      - target:
          entity_id: input_boolean.botc_muted
        action: input_boolean.turn_on
    - conditions:
      - condition: template
        value_template: '{{ mute_state == false }}'
      sequence:
      - target:
          entity_id: light.desk_lamp
        data:
          color_name: green
          brightness: 255
        action: light.turn_on
      - target:
          entity_id: input_boolean.botc_muted
        action: input_boolean.turn_off
  mode: single
- id: '1765649273376'
  alias: 'Christmas Tree Lights Track Kitchen Lights '
  description: ''
  triggers:
  - type: changed_states
    device_id: 294f30f10444bcd2ef6ff9be250834f7
    entity_id: ac8e60292dbb15a275d20f873030af7e
    domain: light
    trigger: device
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: device
        type: is_on
        device_id: 294f30f10444bcd2ef6ff9be250834f7
        entity_id: ac8e60292dbb15a275d20f873030af7e
        domain: light
      sequence:
      - type: turn_on
        device_id: 4e30ea946a5495f14d38b994caec1da0
        entity_id: 6c48f769a82fde13b91b83bdc5ddd39f
        domain: switch
      - action: switch.turn_on
        metadata: {}
        target:
          device_id:
          - e117af1a8759c13997886e55fd6f04c3
          - 4e40123db567ffb641624c13a53b16ee
        data: {}
    default:
    - type: turn_off
      device_id: 4e30ea946a5495f14d38b994caec1da0
      entity_id: 6c48f769a82fde13b91b83bdc5ddd39f
      domain: switch
    - action: switch.turn_off
      metadata: {}
      target:
        device_id:
        - e117af1a8759c13997886e55fd6f04c3
        - 4e40123db567ffb641624c13a53b16ee
      data: {}
  mode: single
- id: '1766937352100'
  alias: SDM120CT Modbus Emulator Inverter Communication
  description: ''
  triggers:
  - type: problem
    device_id: 956055ba5eb10696829a1bbd73949e54
    entity_id: 29f823907cc2a1922cee8aa4283f0b3d
    domain: binary_sensor
    trigger: device
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions: []
  actions:
  - action: notify.mobile_app_rich_mob_app
    metadata: {}
    data:
      message: 'SDM120CT Modbus Emulator Inverter Communication started detecting
        problem. Sent: {{now().strftime(''%Y-%m-%d %I:%M %p'')}}'
      title: SDM120CT
  mode: single
- id: '1766951057635'
  alias: Heating OpenTherm Boiler Control from TRVs
  description: "This automation controls the boiler via the Nest thermostat using
    OpenTherm, based on heat demand from all radiator TRVs. Each TRV exposes two normalized
    signals so third-party devices behave consistently:\n• Heating Max Room Temperature
    Delta (sensor.heating_max_room_temperature_delta)\n  - Largest unmet heating requirement
    across all rooms (setpoint - room temp, negatives clamped to 0)\n  - 0 means no
    room needs heat; larger values mean at least one room is below target\n\n• Heating
    Nest Demand Offset (OpenTherm Friendly) (sensor.heating_nest_demand_offset_opentherm_friendly)\n
    \ - Converts the system-wide delta into a bounded temperature offset added to
    the Nest current temp\n  - Small deltas nudge low flow temperatures for efficient
    burns; larger deltas speed recovery but stay capped\n  - Falls back to 0 if the
    delta is unavailable/invalid\n\nLogic: - If any radiator demands heat and the
    master enable is ON, set Nest target to current temp + offset\n  so the boiler
    modulates via OpenTherm instead of just blasting on/off.\n- If no radiators demand
    heat, wait briefly (optional) then set Nest to a low setback (12°C) so the\n  boiler
    shuts down cleanly.\n\nThis keeps comfort/hysteresis in the TRVs, uses HA only
    for coordination, and lets the boiler run efficiently with OpenTherm modulation
    instead of fixed on/off control.\nUses helpers: heating_max_room_temperature_delta
    and heating_nest_demand_offset_opentherm_friendly "
  triggers:
  - entity_id:
    - binary_sensor.bedroom_radiator_heat_demanded
    - binary_sensor.dining_room_radiator_heat_demanded
    - binary_sensor.guest_bedroom_radiator_heat_demanded
    - binary_sensor.hall_radiator_heat_demanded
    - binary_sensor.kitchen_radiator_heat_demanded
    - binary_sensor.library_radiator_heat_demanded
    - binary_sensor.living_room_radiator_heat_demanded
    - sensor.heating_nest_demand_offset_opentherm_friendly
    - input_boolean.heating_master_enable
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.heating_master_enable
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.bedroom_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.dining_room_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.guest_bedroom_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.hall_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.kitchen_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.library_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.living_room_radiator_heat_demanded
          state: 'on'
        - condition: state
          entity_id: binary_sensor.office_radiator_heat_demanded
          state:
          - 'on'
      sequence:
      - variables:
          base_temp: '{{ state_attr(''climate.hallway'',''current_temperature'') |
            float(15) }}

            '
          offset: '{{ states(''sensor.heating_nest_demand_offset_opentherm_friendly'')
            | float(0) }}

            '
          target_temp: '{{ [ [ base_temp + offset, 32 ] | min, 10 ] | max }}

            '
      - condition: template
        value_template: '{{ target_temp != state_attr(''climate.hallway'',''temperature'')
          | float(0) }}

          '
      - target:
          entity_id: climate.hallway
        data:
          temperature: '{{ target_temp }}'
        action: climate.set_temperature
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.bedroom_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.dining_room_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.guest_bedroom_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.hall_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.kitchen_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.library_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.living_room_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.office_radiator_heat_demanded
          state:
          - 'off'
      sequence:
      - delay:
          minutes: 5
        enabled: false
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.bedroom_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.dining_room_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.guest_bedroom_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.hall_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.kitchen_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.library_radiator_heat_demanded
          state: 'off'
        - condition: state
          entity_id: binary_sensor.living_room_radiator_heat_demanded
          state: 'off'
      - target:
          entity_id: climate.hallway
        data:
          temperature: 12
        action: climate.set_temperature
  mode: restart
- id: '1767491305312'
  alias: Office Air Purifier - Desk Power
  description: 'Turns the office air purifier on or off based on desk power usage.
    Above 100 W indicates the desk is in use and turns the purifier on. Below 100
    W indicates the desk is idle and turns the purifier off.

    '
  triggers:
  - entity_id: sensor.pc_and_desk_real_power
    above: 100
    trigger: numeric_state
  - entity_id: sensor.pc_and_desk_real_power
    below: 100
    trigger: numeric_state
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.pc_and_desk_real_power
        above: 100
      sequence:
      - target:
          entity_id: fan.office_air_purifier_air_purifier_fan
        action: fan.turn_on
    - conditions:
      - condition: numeric_state
        entity_id: sensor.pc_and_desk_real_power
        below: 100
      sequence:
      - target:
          entity_id: fan.office_air_purifier_air_purifier_fan
        action: fan.turn_off
  mode: single
- id: '1767492104023'
  alias: Living Room Air Purifier - Power and Air Quality
  description: 'Controls the living room air purifier using PM2.5 and TV power. PM2.5
    controls fan speed. If PM2.5 is below 5, the fan runs at 33% only when the TV
    is on, otherwise it turns off.

    '
  triggers:
  - entity_id: sensor.ikea_air_quality_sensor_2_pm25
    below: 5
    trigger: numeric_state
  - entity_id: sensor.ikea_air_quality_sensor_2_pm25
    above: 5
    trigger: numeric_state
  - entity_id: sensor.ikea_air_quality_sensor_2_pm25
    above: 15
    trigger: numeric_state
  - entity_id: sensor.ikea_air_quality_sensor_2_pm25
    above: 30
    trigger: numeric_state
  - entity_id: sensor.tv_plug_real_power
    above: 100
    trigger: numeric_state
  - entity_id: sensor.tv_plug_real_power
    below: 100
    trigger: numeric_state
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        above: 30
      sequence:
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        action: fan.turn_on
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        data:
          percentage: 100
        action: fan.set_percentage
    - conditions:
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        above: 15
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        below: 30
      sequence:
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        action: fan.turn_on
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        data:
          percentage: 66
        action: fan.set_percentage
    - conditions:
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        above: 5
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        below: 15
      sequence:
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        action: fan.turn_on
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        data:
          percentage: 33
        action: fan.set_percentage
    - conditions:
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        below: 5
      - condition: numeric_state
        entity_id: sensor.tv_plug_real_power
        above: 100
      sequence:
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        action: fan.turn_on
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        data:
          percentage: 33
        action: fan.set_percentage
    - conditions:
      - condition: numeric_state
        entity_id: sensor.ikea_air_quality_sensor_2_pm25
        below: 5
      - condition: numeric_state
        entity_id: sensor.tv_plug_real_power
        below: 100
      sequence:
      - target:
          entity_id: fan.living_room_air_purifier_air_purifier_fan
        action: fan.turn_off
  mode: single
- id: '1767492625891'
  alias: Heating Master Enable - Presence Based
  description: 'Enables or disables the heating master switch based on presence. If
    either Lucy or Richard is home, heating is enabled. If both are away, heating
    is disabled.

    '
  triggers:
  - entity_id:
    - person.richard
    - person.lucy
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: person.richard
          state: home
        - condition: state
          entity_id: person.lucy
          state: home
      sequence:
      - target:
          entity_id: input_boolean.heating_master_enable
        action: input_boolean.turn_on
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: person.richard
          state: not_home
        - condition: state
          entity_id: person.lucy
          state: not_home
      sequence:
      - target:
          entity_id: input_boolean.heating_master_enable
        action: input_boolean.turn_off
  mode: single
- id: '1767492647046'
  alias: Heating Master Enable - Presence Based
  description: 'Enables or disables the heating master switch based on household presence.
    If either Lucy or Richard is home, heating control is enabled. If both are away,
    heating control is disabled to prevent the boiler running unnecessarily.

    '
  triggers:
  - entity_id:
    - person.richard
    - person.lucy
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: "{{ is_state('person.richard', 'home')\n   or is_state('person.lucy',
          'home') }}\n"
      sequence:
      - target:
          entity_id: input_boolean.heating_master_enable
        action: input_boolean.turn_on
    - conditions:
      - condition: template
        value_template: "{{ is_state('person.richard', 'not_home')\n   and is_state('person.lucy',
          'not_home') }}\n"
      sequence:
      - target:
          entity_id: input_boolean.heating_master_enable
        action: input_boolean.turn_off
  mode: single
